import datasets
import os

frame2id = {"Event_instance": 0, "Luck": 1, "Medical_professionals": 2, "Process_stop": 3, "Agriculture": 4, "Sleep": 5, "Request": 6, "Come_down_with": 7, "Manufacturing": 8, "Ingredients": 9, "Processing_materials": 10, "Intoxicants": 11, "Scope": 12, "Sociability": 13, "Prison": 14, "Trust": 15, "Intercepting": 16, "Take_place_of": 17, "Bungling": 18, "Leadership": 19, "Presence": 20, "People_by_morality": 21, "Activity_prepare": 22, "Political_locales": 23, "Cause_harm": 24, "Expressing_publicly": 25, "Communication_noise": 26, "Origin": 27, "Opportunity": 28, "Objective_influence": 29, "Amassing": 30, "Margin_of_resolution": 31, "Cause_to_wake": 32, "Economy": 33, "Capacity": 34, "Becoming": 35, "Forgiveness": 36, "Be_in_agreement_on_action": 37, "Amounting_to": 38, "Departing": 39, "Defending": 40, "Deserving": 41, "Detaining": 42, "Communication_manner": 43, "Medical_specialties": 44, "Evidence": 45, "People_along_political_spectrum": 46, "Relational_quantity": 47, "Transition_to_a_quality": 48, "Adopt_selection": 49, "Reparation": 50, "Amalgamation": 51, "Inhibit_movement": 52, "Electricity": 53, "Topic": 54, "Relative_time": 55, "Sending": 56, "Activity_pause": 57, "Military": 58, "Expectation": 59, "Extradition": 60, "Aging": 61, "Examination": 62, "Have_associated": 63, "Ingest_substance": 64, "Preventing_or_letting": 65, "Extreme_value": 66, "Achieving_first": 67, "Usefulness": 68, "Education_teaching": 69, "Becoming_silent": 70, "Finish_competition": 71, "Accomplishment": 72, "Cause_to_make_noise": 73, "Fall_asleep": 74, "Food": 75, "Sign": 76, "Telling": 77, "Used_up": 78, "Undergoing": 79, "Colonization": 80, "Obscurity": 81, "Apply_heat": 82, "Being_in_captivity": 83, "Eclipse": 84, "Killing": 85, "Judgment_direct_address": 86, "Bail_decision": 87, "Manner": 88, "Predicament": 89, "Delivery": 90, "Distributed_position": 91, "Robbery": 92, "Motion": 93, "Turning_out": 94, "Location_in_time": 95, "Becoming_dry": 96, "Cause_to_perceive": 97, "Expected_location_of_person": 98, "Process_end": 99, "Dominate_competitor": 100, "Change_of_phase": 101, "Being_in_control": 102, "Halt": 103, "Left_to_do": 104, "Project": 105, "Cause_impact": 106, "Individual_history": 107, "Position_on_a_scale": 108, "Needing": 109, "Destroying": 110, "Possession": 111, "Connecting_architecture": 112, "Thriving": 113, "Gathering_up": 114, "Piracy": 115, "Shapes": 116, "Rescuing": 117, "Perception_active": 118, "Stage_of_progress": 119, "Withdraw_from_participation": 120, "Accompaniment": 121, "Improvement_or_decline": 122, "Punctual_perception": 123, "Becoming_aware": 124, "Rewards_and_punishments": 125, "Using": 126, "Text": 127, "Being_in_effect": 128, "Law": 129, "Kinship": 130, "Change_event_duration": 131, "Popularity": 132, "Infrastructure": 133, "Arrest": 134, "Part_whole": 135, "Regard": 136, "Sound_level": 137, "Delimitation_of_diversity": 138, "Being_at_risk": 139, "Change_post-state": 140, "Practice": 141, "Endangering": 142, "Earnings_and_losses": 143, "Body_parts": 144, "Cogitation": 145, "Contrition": 146, "Relation": 147, "Taking_time": 148, "Ineffability": 149, "Process_start": 150, "Similarity": 151, "Means": 152, "Temporal_subregion": 153, "Range": 154, "System_complexity": 155, "Reveal_secret": 156, "Daring": 157, "Part_ordered_segments": 158, "Likelihood": 159, "Committing_crime": 160, "Exemplar": 161, "Memory": 162, "Fullness": 163, "Dominate_situation": 164, "Duration_relation": 165, "Making_arrangements": 166, "Scarcity": 167, "Deciding": 168, "Being_in_operation": 169, "Catching_fire": 170, "Competition": 171, "Coming_to_be": 172, "Boundary": 173, "Typicality": 174, "Activity_stop": 175, "Wealthiness": 176, "Intentionally_create": 177, "Serving_in_capacity": 178, "Subjective_influence": 179, "Being_wet": 180, "Buildings": 181, "Commerce_sell": 182, "Interior_profile_relation": 183, "Being_dry": 184, "Besieging": 185, "Indigenous_origin": 186, "Progression": 187, "State_of_entity": 188, "Architectural_part": 189, "Intentional_traversing": 190, "Being_necessary": 191, "Change_of_leadership": 192, "Ammunition": 193, "Suitability": 194, "Change_operational_state": 195, "Abounding_with": 196, "Information": 197, "Body_movement": 198, "Inclination": 199, "Part_piece": 200, "Supply": 201, "Point_of_dispute": 202, "Ride_vehicle": 203, "Instance": 204, "Quitting_a_place": 205, "Invading": 206, "Candidness": 207, "Making_faces": 208, "Encoding": 209, "Sent_items": 210, "Religious_belief": 211, "Fastener": 212, "Taking_sides": 213, "Fairness_evaluation": 214, "Assessing": 215, "Scouring": 216, "Sign_agreement": 217, "Soaking_up": 218, "Create_physical_artwork": 219, "Social_event": 220, "Hearsay": 221, "Adjusting": 222, "Enforcing": 223, "Tolerating": 224, "Offshoot": 225, "Social_interaction_evaluation": 226, "Run_risk": 227, "People": 228, "Create_representation": 229, "Operational_testing": 230, "Sounds": 231, "Biological_area": 232, "Heralding": 233, "Labor_product": 234, "Cause_change_of_position_on_a_scale": 235, "Judgment": 236, "Undergo_change": 237, "Cause_to_make_progress": 238, "Being_employed": 239, "Speak_on_topic": 240, "Bearing_arms": 241, "Documents": 242, "Catastrophe": 243, "Categorization": 244, "Disembarking": 245, "Evaluative_comparison": 246, "Medical_conditions": 247, "Judicial_body": 248, "Ranked_expectation": 249, "Success_or_failure": 250, "Cause_to_amalgamate": 251, "Rite": 252, "Hit_or_miss": 253, "Social_connection": 254, "Alliance": 255, "Measure_linear_extent": 256, "Ground_up": 257, "Certainty": 258, "Transfer": 259, "Hiring": 260, "Clothing": 261, "Cause_motion": 262, "Being_attached": 263, "Out_of_existence": 264, "Reliance": 265, "Capability": 266, "Memorization": 267, "Storing": 268, "Offenses": 269, "Misdeed": 270, "Communication_response": 271, "First_experience": 272, "Fear": 273, "Just_found_out": 274, "Foreign_or_domestic_country": 275, "Scrutiny": 276, "Respond_to_proposal": 277, "Mass_motion": 278, "Going_back_on_a_commitment": 279, "Rate_description": 280, "Breathing": 281, "Desiring": 282, "Using_resource": 283, "Intentionally_act": 284, "Cure": 285, "Having_or_lacking_access": 286, "Render_nonfunctional": 287, "Representative": 288, "Commerce_pay": 289, "Notification_of_charges": 290, "Prominence": 291, "Closure": 292, "Preference": 293, "Imprisonment": 294, "Desirable_event": 295, "Ratification": 296, "Getting_vehicle_underway": 297, "Beyond_compare": 298, "History": 299, "Attention": 300, "Translating": 301, "Disgraceful_situation": 302, "Noise_makers": 303, "Addiction": 304, "Attending": 305, "Seeking_to_achieve": 306, "Measurable_attributes": 307, "Attaching": 308, "Gizmo": 309, "Partiality": 310, "Adjacency": 311, "Meet_with": 312, "Cause_fluidic_motion": 313, "Institutionalization": 314, "Motion_noise": 315, "Make_noise": 316, "Perception_experience": 317, "Temperature": 318, "Criminal_investigation": 319, "Completeness": 320, "Waiting": 321, "Discussion": 322, "Reassuring": 323, "Be_in_agreement_on_assessment": 324, "Vocalizations": 325, "Undergo_transformation": 326, "Quantity": 327, "Quantified_mass": 328, "Forgoing": 329, "Obviousness": 330, "Measure_area": 331, "Referring_by_name": 332, "Performing_arts": 333, "Directional_locative_relation": 334, "Cutting": 335, "Physical_artworks": 336, "Accoutrements": 337, "Complaining": 338, "Grinding": 339, "Being_active": 340, "Estimating": 341, "Reason": 342, "Shoot_projectiles": 343, "Fleeing": 344, "Cause_expansion": 345, "Arraignment": 346, "Abandonment": 347, "Statement": 348, "Verdict": 349, "Text_creation": 350, "Placing": 351, "Biological_urge": 352, "Beat_opponent": 353, "Activity_start": 354, "Filling": 355, "Stimulus_focus": 356, "Have_as_requirement": 357, "Make_acquaintance": 358, "Putting_out_fire": 359, "Purpose": 360, "Mental_stimulus_stimulus_focus": 361, "Offering": 362, "Agree_or_refuse_to_act": 363, "Remembering_experience": 364, "Giving_in": 365, "Measure_mass": 366, "Sidereal_appearance": 367, "Linguistic_meaning": 368, "Eventive_affecting": 369, "Process_completed_state": 370, "Emotions_by_stimulus": 371, "Prohibiting_or_licensing": 372, "Measure_duration": 373, "Experience_bodily_harm": 374, "Natural_features": 375, "Emergency_fire": 376, "Frequency": 377, "Response": 378, "Frugality": 379, "Non-gradable_proximity": 380, "Estimated_value": 381, "Animals": 382, "Front_for": 383, "Kidnapping": 384, "Mental_stimulus_exp_focus": 385, "Measure_volume": 386, "Work": 387, "Adducing": 388, "Exchange": 389, "Manipulate_into_doing": 390, "Giving_birth": 391, "Locale_by_event": 392, "Evoking": 393, "Body_mark": 394, "Shopping": 395, "Moving_in_place": 396, "Version_sequence": 397, "Communicate_categorization": 398, "Imposing_obligation": 399, "Proportion": 400, "Trying_out": 401, "Bringing": 402, "Growing_food": 403, "Mining": 404, "Participation": 405, "Path_shape": 406, "Distinctiveness": 407, "Rank": 408, "Board_vehicle": 409, "Interrupt_process": 410, "Color_qualities": 411, "Performers_and_roles": 412, "Expansion": 413, "Compliance": 414, "Execution": 415, "Successful_action": 416, "Rotting": 417, "Judgment_communication": 418, "Partitive": 419, "Excreting": 420, "Expertise": 421, "Existence": 422, "Exporting": 423, "Give_impression": 424, "Experiencer_obj": 425, "Activity_resume": 426, "Affirm_or_deny": 427, "Co-association": 428, "Emphasizing": 429, "Irregular_combatants": 430, "Legality": 431, "Money": 432, "Guilt_or_innocence": 433, "People_by_residence": 434, "Tasting": 435, "Extreme_point": 436, "Degree_of_processing": 437, "Cause_to_start": 438, "Wearing": 439, "Diversity": 440, "Historic_event": 441, "Public_services": 442, "Setting_fire": 443, "Cause_change": 444, "Actually_occurring_entity": 445, "Isolated_places": 446, "Member_of_military": 447, "Temporary_stay": 448, "Abusing": 449, "Dispersal": 450, "Giving": 451, "Dimension": 452, "Path_traveled": 453, "Direction": 454, "Stinginess": 455, "Strictness": 456, "Behind_the_scenes": 457, 
"Being_obligated": 458, "Make_agreement_on_action": 459, "Change_posture": 460, "Attack": 461, "Fields": 462, "Billing": 463, "Medium": 464, "Activity_finish": 465, "Research": 466, "Cause_bodily_experience": 467, "Change_tool": 468, "Vehicle": 469, "Emotion_directed": 470, "Process": 471, "Nuclear_process": 472, "Control": 473, "Level_of_force_resistance": 474, "Possibility": 475, "Arson": 476, "Avoiding": 477, "Roadways": 478, "Creating": 479, "Claim_ownership": 480, "Active_substance": 481, "Convey_importance": 482, "Supporting": 483, "Separating": 484, "Labeling": 485, "Sentencing": 486, "Attempt_means": 487, "Light_movement": 488, "Businesses": 489, "Cause_to_continue": 490, "Verification": 491, "Forging": 492, "Fluidic_motion": 493, "Team": 494, "Grasp": 495, "Being_relevant": 496, "Travel": 497, "Temporal_collocation": 498, "State_continue": 499, "Volubility": 500, "Cause_change_of_phase": 501, "Remembering_information": 502, "Opinion": 503, "Commerce_buy": 504, "Part_inner_outer": 505, "Launch_process": 506, "Destiny": 507, "Try_defendant": 508, "Execute_plan": 509, "Explaining_the_facts": 510, "People_by_origin": 511, "Age": 512, "Confronting_problem": 513, "Hostile_encounter": 514, "Assistance": 515, "Arranging": 516, "Mental_property": 517, "Abundance": 518, "Breaking_out_captive": 519, "Manner_of_life": 520, "Hit_target": 521, "Traversing": 522, "Employing": 523, "Emanating": 524, "Taking": 525, "Redirecting": 526, "People_by_vocation": 527, "People_by_religion": 528, "Body_description_holistic": 529, "Timespan": 530, "Revenge": 531, "Medical_intervention": 532, "Appointing": 533, "Hospitality": 534, "Commemorative": 535, "Terrorism": 536, "Surrendering_possession": 537, "Choosing": 538, "Entering_of_plea": 539, "Come_together": 540, "Concessive": 541, "System": 542, "Building": 543, "Awareness_status": 544, "Type": 545, "Motion_directional": 546, "Name_conferral": 547, "Sequence": 548, "Artificiality": 549, "Hunting": 550, "Degree": 551, "Transition_to_state": 552, "Prevent_or_allow_possession": 553, "Pattern": 554, "Aiming": 555, "Quitting": 556, "Retaining": 557, "Recording": 558, "Judgment_of_intensity": 559, "Craft": 560, "Cardinal_numbers": 561, "Membership": 562, "Simple_name": 563, "Terms_of_agreement": 564, "Damaging": 565, "Required_event": 566, "Source_of_getting": 567, "Reading_activity": 568, "Death": 569, "Secrecy_status": 570, "Biological_entity": 571, "Probability": 572, "Store": 573, "Institutions": 574, "Unattributed_information": 575, "Arriving": 576, "Size": 577, "Impression": 578, "Becoming_a_member": 579, "Self_motion": 580, "Cooking_creation": 581, "Willingness": 582, "Cause_to_fragment": 583, "Collaboration": 584, "Communication": 585, "Conduct": 586, "Locale_by_use": 587, "Cause_emotion": 588, "Fame": 589, "Ambient_temperature": 590, "Locative_relation": 591, "Gesture": 592, "Rest": 593, "Rape": 594, "Forming_relationships": 595, "Cause_to_resume": 596, "Locale_by_ownership": 597, "Weather": 598, "Inspecting": 599, "Installing": 600, "Attributed_information": 601, "Indicating": 602, "Unemployment_rate": 603, "First_rank": 604, "Activity_ongoing": 605, "Attempt_suasion": 606, "Being_questionable": 607, "Trial": 608, "Importing": 609, "Be_subset_of": 610, "Cause_to_end": 611, "Fire_burning": 612, "Compatibility": 613, "Activity_done_state": 614, "Proliferating_in_number": 615, "Removing": 616, "Accuracy": 617, "Emptying": 618, "Lively_place": 619, "Reading_perception": 620, "Part_orientational": 621, "Aggregate": 622, "Chatting": 623, "Spatial_co-location": 624, "Locale": 625, "Awareness": 626, "Commercial_transaction": 627, "Sole_instance": 628, "Familiarity": 629, "Occupy_rank": 630, "Process_resume": 631, "Suasion": 632, "Color": 633, "Thwarting": 634, "Organization": 635, "Coming_to_believe": 636, "Theft": 637, "Reference_text": 638, "Connectors": 639, "Hindering": 640, "Omen": 641, "Containers": 642, "Preliminaries": 643, "Sufficiency": 644, "Facial_expression": 645, "Morality_evaluation": 646, "Being_located": 647, "Justifying": 648, "Intentionally_affect": 649, "Deny_or_grant_permission": 650, "Visiting": 651, "Legal_rulings": 652, "Posture": 653, "Network": 654, "People_by_jurisdiction": 655, "Proper_reference": 656, "Substance": 657, "Surviving": 658, "Smuggling": 659, "Commitment": 660, "Weapon": 661, "Suspicion": 662, "Subversion": 663, "Sensation": 664, "Ceasing_to_be": 665, "Containing": 666, "Contacting": 667, "Conquering": 668, "Importance": 669, "Submitting_documents": 670, "Firing": 671, "Cause_change_of_strength": 672, "Correctness": 673, "Exchange_currency": 674, "Feeling": 675, "Temporal_pattern": 676, "Causation": 677, "Predicting": 678, "Protecting": 679, "Preserving": 680, "Relational_natural_features": 681, "Releasing": 682, "Reasoning": 683, "Residence": 684, "Replacing": 685, "Receiving": 686, "Reshaping": 687, "Expensiveness": 688, "Reporting": 689, "Subordinates_and_superiors": 690, "Operate_vehicle": 691, "Manipulation": 692, "Rebellion": 693, "Touring": 694, "Location_of_light": 695, "Being_operational": 696, "Remainder": 697, "Chemical-sense_description": 698, "Entity": 699, "Desirability": 700, "Commerce_scenario": 701, "Food_gathering": 702, "Holding_off_on": 703, "Within_distance": 704, "Resolve_problem": 705, "Questioning": 706, "Being_named": 707, "Risky_situation": 708, "Negation": 709, "Calendric_unit": 710, "Alternatives": 711, "Renting": 712, "Reliance_on_expectation": 713, "Increment": 714, "Simple_naming": 715, "Clothing_parts": 716, "Simultaneity": 717, "Rejuvenation": 718, "Precipitation": 719, "Renunciation": 720, "Prevarication": 721, "Attempt": 722, "Law_enforcement_agency": 723, "Ingestion": 724, "Level_of_force_exertion": 725, "Inclusion": 726, "Spatial_contact": 727, "Custom": 728, "Hiding_objects": 729, "People_by_age": 730, "Contingency": 731, "Coincidence": 732, "Impact": 733, "Quarreling": 734, "Aesthetics": 735, "Cognitive_connection": 736, "Getting": 737, "Being_incarcerated": 738, "Coming_up_with": 739, "Change_event_time": 740, "Setting_out": 741, "Openness": 742, "Assemble": 743, "Reading_aloud": 744, "Difficulty": 745, "Change_position_on_a_scale": 746, "Planned_trajectory": 747, "Becoming_separated": 748, "Cause_to_move_in_place": 749, "Continued_state_of_affairs": 750, "Experiencer_focus": 751, "Seeking": 752, "Emotions_of_mental_activity": 753, "Immobilization": 754, "Firefighting": 755, "Reforming_a_system": 756, "Identicality": 757, "Locating": 758, "Event": 759, "Attitude_description": 760, "Personal_relationship": 761, "Goal": 762, "Artifact": 763, "Emotion_active": 764, "Recovery": 765, "Duration_description": 766, "Speed_description": 767, "Relational_political_locales": 768, "Win_prize": 769, "Rate_quantification": 770, "Summarizing": 771, "Cause_to_experience": 772, "Activity_ready_state": 773, "Sharpness": 774, "Escaping": 775, "Waking_up": 776, "Toxic_substance": 777, "Dead_or_alive": 778, "Differentiation": 779, "Operating_a_system": 780, "Change_direction": 781, "Proportional_quantity": 782, "Domain": 783, "Time_vector": 784, "Ordinal_numbers": 785, "Trendiness": 786, "Idiosyncrasy": 787, "Building_subparts": 788, "Being_born": 789, "Being_in_category": 790, "Process_continue": 791, "Carry_goods": 792, "Duplication": 793, "Make_cognitive_connection": 794, "Cotheme": 795}

class SesameConfig(datasets.BuilderConfig):
    def __init__(self, **kwargs):
        super.__init__(**kwargs)
        self.train_file = 'fn1.7.fulltext.train.syntaxnet.conll'
        self.dev_file =  'fn1.7.dev.syntaxnet.conll'
        self.test_file = 'fn1.7.test.syntaxnet.conll'


class Sesame(datasets.GeneratorBasedBuilder):

    BUILDER_CONFIG_CLASS = SesameConfig

    def _info(self):
        return datasets.DatasetInfo(
            description = 'FrameNet annotation in Conll format',
            features = datasets.Features(
                {
                    'id':datasets.Value('int32'),
                    'sent_id':datasets.Value('int32'),
                    'tokens':datasets.Sequence(datasets.Value('string')),
                    'frame_tags':datasets.Sequence(datasets.features.ClassLabel(num_classes=len(frame2id), names=frame2id.keys()))
                }
            )
        )
    
    def _split_generators(self, dl_manager):

        return [
            datasets.SplitGenerator(name=datasets.Split.TRAIN, gen_kwargs={'filepath': os.path.join(self.config.data_dir, self.config.train_file)}),
            datasets.SplitGenerator(name=datasets.Split.VALIDATION, gen_kwargs={'filepath': os.path.join(self.config.data_dir, self.config.dev_file)}),
            datasets.SplitGenerator(name=datasets.Split.TEST, gen_kwargs={'filepath': os.path.join(self.config.data_dir, self.config.test_file)}),
        ]
    
    def _generate_examples(self, filepath):
        with open(filepath, encoding='utf-8') as f:
            id = 0
            sent_id = 0
            tokens = []
            frame_tags = []
            for line in f:
                if line == '' or line == '\n':
                    if tokens:
                        yield id, {
                            'id': id,
                            'sent_id': sent_id,
                            'tokens': tokens,
                            'frame_tags': frame_tags
                        }
                        id+=1
                        tokens=[]
                        frame_tags = []
                else:
                    splits = line.split('\t')
                    tokens.append(splits[1])
                    frame_tags.append(splits[-2])
                    sent_id = int(splits[6])
            yield id, {
                'id': id,
                'sent_id': sent_id,
                'tokens': tokens,
                'frame_tags': frame_tags
            }